package de.bybackfish.avalonaddons.features.dev

import de.bybackfish.avalonaddons.core.annotations.Category
import de.bybackfish.avalonaddons.core.annotations.Property
import de.bybackfish.avalonaddons.core.event.Subscribe
import de.bybackfish.avalonaddons.core.feature.Feature
import de.bybackfish.avalonaddons.events.ClientTickEvent
import net.fabricmc.fabric.api.event.lifecycle.v1.ServerTickEvents
import net.minecraft.client.MinecraftClient
import net.minecraft.util.Hand

@Category("Dev")
class NPCExploit: Feature() {

    @Property(
        description = "Command to execute",
    )
    var command = "say Hello World!"

    @Property(
        description = "Toggle the exploit",
    )
    var toggle = false

    var lastTick = 0L
    var iterations = 0

    fun doFunStuff() {
        val npcLookingAt = mc.targetedEntity ?: return
        mc.interactionManager!!.interactEntity(mc.player, npcLookingAt, Hand.MAIN_HAND)
        toggle = true
    }

    @Subscribe
    fun onServerTick(event: ClientTickEvent) {
        if(player == null) return
        if(toggle) {
            if(iterations == 10) {
                toggle = false
                iterations = 0
                return
            }
            if(System.currentTimeMillis() - lastTick > 30) {
                lastTick = System.currentTimeMillis()
                iterations++
                mc.networkHandler!!.sendChatCommand(command)
            }
        }
    }

}